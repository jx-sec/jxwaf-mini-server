(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-242714c0"],{4414:function(e,t,a){"use strict";a.r(t);var o=a("7a23");const i=Object(o["createVNode"])("h3",null,"流量转发配置",-1),l={class:"domain-search-input"},r=Object(o["createTextVNode"])("新增"),c={class:"demo-block"},d=Object(o["createTextVNode"])("编辑"),s=Object(o["createVNode"])("p",null,"确定删除吗？",-1),n={style:{"text-align":"right",margin:"0"}},u=Object(o["createTextVNode"])("取消"),b=Object(o["createTextVNode"])("确定 "),p=Object(o["createTextVNode"])("删除"),m={key:0},f={class:"match_key_title"},O={class:"match-box-type"},j={class:"match-box-content"},h=Object(o["createTextVNode"])("删除"),_=Object(o["createTextVNode"])("新增"),V=Object(o["createVNode"])("i",{class:"el-icon-plus"},null,-1),g=Object(o["createTextVNode"])("取消"),y=Object(o["createTextVNode"])("确定");function w(e,t,a,w,C,v){const k=Object(o["resolveComponent"])("el-col"),N=Object(o["resolveComponent"])("el-row"),x=Object(o["resolveComponent"])("el-divider"),I=Object(o["resolveComponent"])("el-input"),F=Object(o["resolveComponent"])("el-button"),L=Object(o["resolveComponent"])("el-table-column"),T=Object(o["resolveComponent"])("el-popover"),B=Object(o["resolveComponent"])("el-table"),S=Object(o["resolveComponent"])("el-form-item"),U=Object(o["resolveComponent"])("el-switch"),q=Object(o["resolveComponent"])("el-option"),M=Object(o["resolveComponent"])("el-select"),D=Object(o["resolveComponent"])("el-tag"),$=Object(o["resolveComponent"])("el-form"),P=Object(o["resolveComponent"])("el-dialog");return Object(o["openBlock"])(),Object(o["createBlock"])(N,null,{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(k,{span:24},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(N,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(k,{span:24},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(N,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(k,{span:12},{default:Object(o["withCtx"])(()=>[i]),_:1})]),_:1})]),_:1})]),_:1}),Object(o["createVNode"])(x),Object(o["createVNode"])(N,{class:"text-align-right"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])("div",l,[Object(o["createVNode"])(I,{placeholder:"请输入名称进行搜索","prefix-icon":"el-icon-search",modelValue:C.domainSearch,"onUpdate:modelValue":t[1]||(t[1]=e=>C.domainSearch=e)},null,8,["modelValue"])]),Object(o["createVNode"])(F,{type:"primary",onClick:t[2]||(t[2]=e=>v.onClickCreateIdentity())},{default:Object(o["withCtx"])(()=>[r]),_:1})]),_:1}),Object(o["createVNode"])("div",c,[Object(o["createVNode"])(B,{data:C.tableData.filter(e=>!C.domainSearch||e.name.toLowerCase().includes(C.domainSearch.toLowerCase())),style:{width:"100%"}},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(L,{prop:"name",label:"名称"}),Object(o["createVNode"])(L,{prop:"detail",label:"详情"}),Object(o["createVNode"])(L,{prop:"traffic_forward_ip",label:"转发地址"}),Object(o["createVNode"])(L,{prop:"traffic_forward_port",label:"转发端口"}),Object(o["createVNode"])(L,{label:"操作",align:"right"},{default:Object(o["withCtx"])(e=>[Object(o["createVNode"])(F,{size:"mini",onClick:t=>v.handleEdit(e.row),class:"button-block",type:"text",loading:e.row.loading},{default:Object(o["withCtx"])(()=>[d]),_:2},1032,["onClick","loading"]),Object(o["createVNode"])(T,{placement:"top",width:"160",visible:e.row.isVisiblePopover,"onUpdate:visible":t=>e.row.isVisiblePopover=t},{reference:Object(o["withCtx"])(()=>[Object(o["createVNode"])(F,{type:"text",size:"mini",onClick:t=>e.row.isVisiblePopover=!0},{default:Object(o["withCtx"])(()=>[p]),_:2},1032,["onClick"])]),default:Object(o["withCtx"])(()=>[s,Object(o["createVNode"])("div",n,[Object(o["createVNode"])(F,{size:"mini",type:"text",onClick:t=>e.row.isVisiblePopover=!1},{default:Object(o["withCtx"])(()=>[u]),_:2},1032,["onClick"]),Object(o["createVNode"])(F,{type:"primary",size:"mini",onClick:t=>v.handleDelete(e.row),loading:C.loading},{default:Object(o["withCtx"])(()=>[b]),_:2},1032,["onClick","loading"])])]),_:2},1032,["visible","onUpdate:visible"])]),_:1})]),_:1},8,["data"])])]),_:1}),Object(o["createVNode"])(P,{title:C.domainTitle,modelValue:C.dialogIdentityFormVisible,"onUpdate:modelValue":t[12]||(t[12]=e=>C.dialogIdentityFormVisible=e),width:"820px","close-on-click-modal":!1,onClosed:v.dialogClose},{footer:Object(o["withCtx"])(()=>[Object(o["createVNode"])(F,{onClick:t[10]||(t[10]=e=>C.dialogIdentityFormVisible=!1)},{default:Object(o["withCtx"])(()=>[g]),_:1}),Object(o["createVNode"])(F,{type:"primary",onClick:t[11]||(t[11]=e=>v.onClickIdentitySubmit("identityForm")),loading:C.loading},{default:Object(o["withCtx"])(()=>[y]),_:1},8,["loading"])]),default:Object(o["withCtx"])(()=>[Object(o["createVNode"])($,{class:"form-tag-dialog identity-edit-form ",model:C.identityForm,size:"mini","label-position":"left","label-width":"130px",rules:v.rules,ref:"identityForm"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(S,{label:"名称",prop:"name",key:"1"},{default:Object(o["withCtx"])(()=>["new"==C.domainType?(Object(o["openBlock"])(),Object(o["createBlock"])(I,{key:0,modelValue:C.identityForm.name,"onUpdate:modelValue":t[3]||(t[3]=e=>C.identityForm.name=e),placeholder:"请输入字母开头，只包含字母、数字、下划线“_”、中横线“-”"},null,8,["modelValue"])):Object(o["createCommentVNode"])("",!0),"edit"==C.domainType?(Object(o["openBlock"])(),Object(o["createBlock"])(I,{key:1,modelValue:C.identityForm.name,"onUpdate:modelValue":t[4]||(t[4]=e=>C.identityForm.name=e),disabled:"disabled"},null,8,["modelValue"])):Object(o["createCommentVNode"])("",!0)]),_:1}),Object(o["createVNode"])(S,{label:"详情",key:"2"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(I,{modelValue:C.identityForm.detail,"onUpdate:modelValue":t[5]||(t[5]=e=>C.identityForm.detail=e),placeholder:"请输入详情"},null,8,["modelValue"])]),_:1}),Object(o["createVNode"])(S,{label:"自定义header头",key:"3"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(U,{modelValue:C.identityForm.set_request_header_status,"onUpdate:modelValue":t[6]||(t[6]=e=>C.identityForm.set_request_header_status=e),"active-value":"true","inactive-value":"false"},null,8,["modelValue"])]),_:1}),"true"==C.identityForm.set_request_header_status?(Object(o["openBlock"])(),Object(o["createBlock"])("div",m,[Object(o["createVNode"])(S,{label:"响应头配置",class:"longer-cascader traffic-forward-item"},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(C.ruleConfigMatchs,(t,a)=>(Object(o["openBlock"])(),Object(o["createBlock"])("div",{class:"match-box",key:"matchs"+a},[Object(o["createVNode"])("div",f,[Object(o["createVNode"])(I,{modelValue:t.key,"onUpdate:modelValue":e=>t.key=e,placeholder:"key"},null,8,["modelValue","onUpdate:modelValue"])]),Object(o["createVNode"])("div",O,[Object(o["createVNode"])(M,{modelValue:t.type,"onUpdate:modelValue":e=>t.type=e,placeholder:"请选择"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(q,{label:"设置值",value:"set_value"}),Object(o["createVNode"])(q,{label:"删除值",value:"del_value"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),Object(o["createVNode"])("div",j,[Object(o["withDirectives"])(Object(o["createVNode"])(I,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,placeholder:"value"},null,8,["modelValue","onUpdate:modelValue"]),[[o["vShow"],"set_value"==t.type]])]),Object(o["createVNode"])(F,{onClick:Object(o["withModifiers"])(a=>v.removeConfigMatchs(t,e.bigIndex),["prevent"])},{default:Object(o["withCtx"])(()=>[h]),_:2},1032,["onClick"])]))),128)),Object(o["createVNode"])(F,{onClick:t[7]||(t[7]=t=>v.addConfigMatchs(e.bigIndex)),plain:"",type:"primary",class:"button-new"},{default:Object(o["withCtx"])(()=>[_]),_:1})]),_:1})])):Object(o["createCommentVNode"])("",!0),Object(o["createVNode"])(S,{label:"转发地址",key:"4"},{default:Object(o["withCtx"])(()=>[(Object(o["openBlock"])(!0),Object(o["createBlock"])(o["Fragment"],null,Object(o["renderList"])(C.sourceIpList,(e,t)=>(Object(o["openBlock"])(),Object(o["createBlock"])(D,{key:t,closable:"","disable-transitions":!1,onClose:t=>v.handleCloseSourceIpList(e)},{default:Object(o["withCtx"])(()=>[Object(o["createTextVNode"])(Object(o["toDisplayString"])(e),1)]),_:2},1032,["onClose"]))),128)),C.sourceIpListVisible?(Object(o["openBlock"])(),Object(o["createBlock"])(I,{key:0,class:"input-new-tag node-ip-list",modelValue:C.sourceIpListValue,"onUpdate:modelValue":t[8]||(t[8]=e=>C.sourceIpListValue=e),ref:"saveTagSourceIpList",size:"mini",onKeyup:Object(o["withKeys"])(v.handleSourceIpListConfirm,["enter"]),onBlur:v.handleSourceIpListConfirm},null,8,["modelValue","onKeyup","onBlur"])):(Object(o["openBlock"])(),Object(o["createBlock"])(F,{key:1,class:"button-new-tag",size:"small",onClick:v.showSourceIpList},{default:Object(o["withCtx"])(()=>[V]),_:1},8,["onClick"]))]),_:1}),Object(o["createVNode"])(S,{label:"转发端口",prop:"traffic_forward_port",key:"5"},{default:Object(o["withCtx"])(()=>[Object(o["createVNode"])(I,{modelValue:C.identityForm.traffic_forward_port,"onUpdate:modelValue":t[9]||(t[9]=e=>C.identityForm.traffic_forward_port=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClosed"])]),_:1})}var C=a("362c"),v={mixins:[C["b"]],data(){return{domainTitle:"新增",domainType:"new",domainSearch:"",dialogIdentityFormVisible:!1,loading:!1,identityForm:{name:"",detail:"",traffic_forward_ip:"",traffic_forward_port:"80"},tableData:[],sourceIpList:[],sourceIpListVisible:!1,sourceIpListValue:"",flagTag:!0,ruleConfigMatchs:[{key:"",type:"set_value",value:""}]}},computed:{rules(){return{name:[{required:!0,message:"请输入字母开头，只包含字母、数字、下划线“_”、中横线“-”",trigger:["blur","change"]},{validator:C["g"],trigger:["blur","change"]}],traffic_forward_port:[{required:!0,message:"请输入转发端口信息",trigger:["blur","change"]},{validator:C["e"],trigger:["blur","change"]}]}}},mounted(){this.getData()},methods:{handleCloseSourceIpList(e){this.sourceIpList.splice(this.sourceIpList.indexOf(e),1)},showSourceIpList(){this.sourceIpListVisible=!0,this.$nextTick(e=>{this.$refs.saveTagSourceIpList.$refs.input.focus()})},handleSourceIpListConfirm(){let e=this,t=this.sourceIpListValue,a=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e.flagTag&&(e.flagTag=!1,t?a.test(t)?Object(C["a"])("post","/ip_check",{ip:t},(function(a){a.data.result?(e.sourceIpList.push(t),e.sourceIpListVisible=!1,e.sourceIpListValue=""):e.$message({showClose:!0,message:"请输入正确的IP地址",type:"error"})}),(function(){}),"no-message"):e.$message({showClose:!0,message:"请输入转发IP地址",type:"error"}):(e.sourceIpListVisible=!1,e.sourceIpListValue=""),setTimeout((function(){e.flagTag=!0}),50))},getData(){var e=this;Object(C["a"])("get","/waf/waf_get_sys_traffic_forward_list",{},(function(t){e.tableData=t.data.message,e.tableData.forEach(e=>{e.isVisiblePopover=!1})}),(function(){}))},dialogClose(){this.identityForm={name:"",detail:"",set_request_header_status:"false",traffic_forward_ip:"",traffic_forward_port:"80"},this.ruleConfigMatchs=[{key:"",value:"",type:"set_value"}],this.sourceIpListVisible=!1,this.sourceIpListValue="",this.sourceIpList=[],this.$refs["identityForm"].resetFields()},onClickIdentitySubmit(e){var t=this,a="/waf/waf_create_sys_traffic_forward";return"edit"==t.domainType&&(a="/waf/waf_edit_sys_traffic_forward"),0==t.sourceIpList.length?(t.$message({message:"IP不能为空",type:"error"}),!1):"true"==t.identityForm.set_request_header_status&&0==t.ruleConfigMatchs.length?(t.$message({message:"请对自定义header头进行配置",type:"error"}),!1):(t.identityForm.set_request_header_value=JSON.stringify(t.ruleConfigMatchs),t.identityForm.traffic_forward_ip=t.sourceIpList.join(","),void this.$refs[e].validate(e=>{e&&(t.loading=!0,Object(C["a"])("post",a,t.identityForm,(function(e){t.loading=!1,t.dialogIdentityFormVisible=!1,t.sourceIpListVisible=!1,t.sourceIpListValue="",t.sourceIpList=[],t.getData()}),(function(){t.loading=!1})))}))},onClickCreateIdentity(){var e=this;e.domainTitle="新增",e.domainType="new",e.dialogIdentityFormVisible=!0},handleEdit(e){var t=this;e.loading=!0,Object(C["a"])("post","/waf/waf_get_sys_traffic_forward",{name:e.name},(function(a){e.loading=!1;var o=a.data.message;if(t.identityForm.name=o.name,t.identityForm.detail=o.detail,t.identityForm.traffic_forward_ip=o.traffic_forward_ip,t.identityForm.traffic_forward_port=o.traffic_forward_port,t.sourceIpList=o.traffic_forward_ip?o.traffic_forward_ip.split(","):[],t.identityForm.set_request_header_status=o.set_request_header_status,t.identityForm.set_request_header_value=o.set_request_header_value,"true"==t.identityForm.set_request_header_status){var i=JSON.parse(t.identityForm.set_request_header_value),l=[];for(var r in i){var c=i[r];l.push({key:c.key,value:c.value,type:c.type})}t.ruleConfigMatchs=l}t.domainTitle="编辑",t.domainType="edit",t.dialogIdentityFormVisible=!0}),(function(){e.loading=!1}),"no-message")},handleDelete(e){var t=this;t.loading=!0,Object(C["a"])("post","/waf/waf_del_sys_traffic_forward",{name:e.name},(function(a){e.isVisiblePopover=!1,t.loading=!1,t.getData()}),(function(){t.loading=!1}))},removeConfigMatchs(e){var t=this.ruleConfigMatchs.indexOf(e);t>0&&this.ruleConfigMatchs.splice(t,1)},addConfigMatchs(){this.ruleConfigMatchs.push({key:"",value:"",type:"set_value"})}}},k=(a("b818"),a("d959")),N=a.n(k);const x=N()(v,[["render",w]]);t["default"]=x},b818:function(e,t,a){"use strict";a("fea1")},fea1:function(e,t,a){}}]);
//# sourceMappingURL=chunk-242714c0.50b472d8.js.map