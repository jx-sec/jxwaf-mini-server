(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51f177a6"],{"2fc6":function(e,a,t){"use strict";t("d714")},d714:function(e,a,t){},fc30:function(e,a,t){"use strict";t.r(a);var l=t("7a23");const o={class:"custom-edit-wrap"},r=Object(l["createTextVNode"])("网站防护"),c=Object(l["createTextVNode"])("防护配置"),n=Object(l["createTextVNode"])("网页防篡改"),u=Object(l["createTextVNode"])("新增"),d=Object(l["createTextVNode"])("编辑"),s={class:"match-box-content"},i={class:"match_key_cascader"},m={class:"match_key_input"},p=Object(l["createTextVNode"])("删除"),h=Object(l["createTextVNode"])("新增"),b={class:"match-box",style:{width:"100%"}},_={class:"match-box-content",style:{width:"calc(100% - 160px)"}},f=Object(l["createTextVNode"])("获取页面内容"),g=Object(l["createTextVNode"])("保存 ");function O(e,a,t,O,j,w){const v=Object(l["resolveComponent"])("el-breadcrumb-item"),V=Object(l["resolveComponent"])("el-breadcrumb"),y=Object(l["resolveComponent"])("el-row"),k=Object(l["resolveComponent"])("el-input"),x=Object(l["resolveComponent"])("el-form-item"),C=Object(l["resolveComponent"])("el-cascader"),N=Object(l["resolveComponent"])("el-button"),T=Object(l["resolveComponent"])("el-form"),P=Object(l["resolveComponent"])("el-col"),M=Object(l["resolveDirective"])("loading");return Object(l["openBlock"])(),Object(l["createBlock"])("div",o,[Object(l["createVNode"])(y,{class:"breadcrumb-style"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(V,{separator:"/"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(v,{to:{path:"/"}},{default:Object(l["withCtx"])(()=>[r]),_:1}),Object(l["createVNode"])(v,{to:{path:"/protection/"+j.domain}},{default:Object(l["withCtx"])(()=>[c]),_:1},8,["to"]),Object(l["createVNode"])(v,{to:{path:"/scan-attack-protection/"+j.domain}},{default:Object(l["withCtx"])(()=>[n]),_:1},8,["to"]),"new"==j.uuid?(Object(l["openBlock"])(),Object(l["createBlock"])(v,{key:0},{default:Object(l["withCtx"])(()=>[u]),_:1})):(Object(l["openBlock"])(),Object(l["createBlock"])(v,{key:1},{default:Object(l["withCtx"])(()=>[d]),_:1}))]),_:1})]),_:1}),Object(l["createVNode"])(y,{class:"container-style"},{default:Object(l["withCtx"])(()=>[Object(l["withDirectives"])(Object(l["createVNode"])(P,{span:24},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(T,{class:"custom-edit-form",model:j.pageTamperProofForm,rules:w.rules,ref:"pageTamperProofForm","label-width":"180px"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])("div",null,[Object(l["createVNode"])(x,{label:"规则名称",prop:"rule_name"},{default:Object(l["withCtx"])(()=>["new"==j.uuid?(Object(l["openBlock"])(),Object(l["createBlock"])(k,{key:0,modelValue:j.pageTamperProofForm.rule_name,"onUpdate:modelValue":a[1]||(a[1]=e=>j.pageTamperProofForm.rule_name=e),placeholder:"请输入字母开头，字母或数字组合，仅支持_-两种符号"},null,8,["modelValue"])):(Object(l["openBlock"])(),Object(l["createBlock"])(k,{key:1,modelValue:j.pageTamperProofForm.rule_name,"onUpdate:modelValue":a[2]||(a[2]=e=>j.pageTamperProofForm.rule_name=e),disabled:""},null,8,["modelValue"]))]),_:1}),Object(l["createVNode"])(x,{label:"规则详情"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(k,{modelValue:j.pageTamperProofForm.rule_detail,"onUpdate:modelValue":a[3]||(a[3]=e=>j.pageTamperProofForm.rule_detail=e)},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(x,{label:"规则匹配",class:"is-required"},{default:Object(l["withCtx"])(()=>[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(j.ruleSmallMatchs,(e,a)=>(Object(l["openBlock"])(),Object(l["createBlock"])("div",{class:"match-box",key:a},[Object(l["createVNode"])("div",s,[Object(l["createVNode"])("div",i,[Object(l["createVNode"])(C,{separator:":",modelValue:e.rule_match_key_list,"onUpdate:modelValue":a=>e.rule_match_key_list=a,options:j.optionsMatchKey,props:j.propsMatchKey,onChange:a=>w.onChangeRuleMatchs(a,e),clearable:""},null,8,["modelValue","onUpdate:modelValue","options","props","onChange"])]),Object(l["withDirectives"])(Object(l["createVNode"])("div",m,[Object(l["createVNode"])(k,{modelValue:e.rule_match_key,"onUpdate:modelValue":a=>e.rule_match_key=a,clearable:"",onChange:a=>w.onChangeRuleInput(a,e)},null,8,["modelValue","onUpdate:modelValue","onChange"])],512),[[l["vShow"],e.showInput]])]),Object(l["createVNode"])(N,{onClick:Object(l["withModifiers"])(a=>w.removeRuleMatchs(e),["prevent"])},{default:Object(l["withCtx"])(()=>[p]),_:2},1032,["onClick"])]))),128)),Object(l["createVNode"])(N,{onClick:a[4]||(a[4]=e=>w.addRuleMatchs()),plain:"",type:"primary",class:"button-new"},{default:Object(l["withCtx"])(()=>[h]),_:1})]),_:1}),Object(l["createVNode"])(x,{label:"页面地址",class:"is-required"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])("div",b,[Object(l["createVNode"])("div",_,[Object(l["createVNode"])(k,{modelValue:j.pageTamperProofForm.cache_page_url,"onUpdate:modelValue":a[5]||(a[5]=e=>j.pageTamperProofForm.cache_page_url=e),placeholder:"请输入完整地址，例如：https://www.jxwaf.com"},null,8,["modelValue"])]),Object(l["createVNode"])(N,{type:"primary",plain:"",onClick:a[6]||(a[6]=e=>w.getPageUrl()),loading:j.loading},{default:Object(l["withCtx"])(()=>[f]),_:1},8,["loading"])])]),_:1}),Object(l["createVNode"])(x,{label:"页面内容"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(k,{modelValue:j.pageTamperProofForm.cache_page_content,"onUpdate:modelValue":a[7]||(a[7]=e=>j.pageTamperProofForm.cache_page_content=e),type:"textarea",rows:4},null,8,["modelValue"])]),_:1}),Object(l["createVNode"])(x,{label:"内容类型"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(k,{modelValue:j.pageTamperProofForm.cache_content_type,"onUpdate:modelValue":a[8]||(a[8]=e=>j.pageTamperProofForm.cache_content_type=e)},null,8,["modelValue"])]),_:1})])]),_:1},8,["model","rules"]),Object(l["createVNode"])(y,{type:"flex",class:"margin-border",justify:"space-between"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(P,{span:12},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])("a",{class:"el-button el-button--primary is-plain",href:"/#/page-tamper-proof/"+j.domain},"返回",8,["href"])]),_:1}),Object(l["createVNode"])(P,{span:12,class:"text-align-right"},{default:Object(l["withCtx"])(()=>[Object(l["createVNode"])(N,{type:"primary",onClick:a[9]||(a[9]=e=>w.onClickWebRuleProSubmit("pageTamperProofForm")),loading:j.loading},{default:Object(l["withCtx"])(()=>[g]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512),[[M,j.loadingPage,void 0,{fullscreen:!0,lock:!0}]])]),_:1})])}var j=t("362c"),w=t("6c02"),v={mixins:[j["c"]],data(){return{loading:!1,loadingPage:!1,domain:"",uuid:"new",pageTamperProofForm:{rule_detail:""},type:"edit",optionsMatchKey:[{value:"http_args",label:"http_args",children:[{value:"path",label:"path",leaf:!0},{value:"query_string",label:"query_string",leaf:!0},{value:"method",label:"method",leaf:!0},{value:"src_ip",label:"src_ip",leaf:!0},{value:"raw_body",label:"raw_body",leaf:!0},{value:"version",label:"version",leaf:!0},{value:"scheme",label:"scheme",leaf:!0},{value:"raw_header",label:"raw_header",leaf:!0}]},{value:"header_args",label:"header_args",children:[{value:"host",label:"host",leaf:!0},{value:"cookie",label:"cookie",leaf:!0},{value:"referer",label:"referer",leaf:!0},{value:"user_agent",label:"user_agent",leaf:!0},{value:"default",label:"自定义",leaf:!0}]},{value:"cookie_args",label:"cookie_args",children:[{value:"default",label:"自定义",leaf:!0}]},{value:"uri_args",label:"uri_args",children:[{value:"default",label:"自定义",leaf:!0}]},{value:"post_args",label:"post_args",children:[{value:"default",label:"自定义",leaf:!0}]},{value:"json_post_args",label:"json_post_args",children:[{value:"default",label:"自定义",leaf:!0}]}],ruleSmallMatchs:[{rule_match_key_list:[],rule_match_key:"",showInput:!1}],propsMatchKey:{expandTrigger:"hover"}}},computed:{rules(){return{rule_name:[{required:!0,message:"请输入规则名称",trigger:["blur","change"]},{validator:j["i"],trigger:["blur","change"]}]}}},mounted(){var e=this;const a=Object(w["c"])();e.uuid=a.params.uuid,e.domain=a.params.domain,e.loadingPage=!1,"new"!=e.uuid&&e.getData()},methods:{getData(){var e=this,a="/waf/waf_get_web_page_tamper_proof",t={domain:e.domain,rule_name:e.uuid};Object(j["a"])("post",a,t,(function(a){e.loadingPage=!1,e.pageTamperProofForm=a.data.message,e.pageTamperProofForm.rule_name=e.uuid;var t=JSON.parse(e.pageTamperProofForm.rule_matchs),l=[],o=["query_string","json_post","post","cookie","waf_description","ctx","string"];for(var r in t){var c=t[r],n=c.key,u=c.value,d="false";o.indexOf(n)>-1&&(d="true"),l.push({rule_match_key_list:[n,u],rule_match_key:n+":"+u,showInput:d})}e.ruleSmallMatchs=l}),(function(){e.loadingPage=!1}),"no-message")},onClickWebRuleProSubmit(e){var a=this,t=[];if(0==a.ruleSmallMatchs.length)return a.$message({message:"请选择统计对象",type:"error"}),!1;if(""==a.ruleSmallMatchs[0].rule_match_key)return a.$message({message:"请选择统计对象",type:"error"}),!1;for(var l in a.ruleSmallMatchs){var o=a.ruleSmallMatchs[l],r="",c=[],n="",u="";o.rule_match_key&&(c=o.rule_match_key.split(":")),c.length>0&&(n=c[0],u=o.rule_match_key.replace(new RegExp(n+":"),""),r='{"key":"'+n+'" , "value":"'+u+'"}'),t.push(JSON.parse(r))}a.pageTamperProofForm.domain=a.domain;var d="/waf/waf_edit_web_page_tamper_proof";"new"==a.uuid?d="/waf/waf_create_web_page_tamper_proof":a.pageTamperProofForm.rule_name=a.uuid,a.pageTamperProofForm.rule_matchs=JSON.stringify(t),this.$refs[e].validate(e=>{e&&(a.loading=!0,Object(j["a"])("post",d,a.pageTamperProofForm,(function(e){a.loading=!1,window.location.href="/#/page-tamper-proof/"+a.domain}),(function(){a.loading=!1})))})},getPageUrl(){var e=this,a=e.pageTamperProofForm.cache_page_url;if(!a)return e.$message({message:"请输入页面地址",type:"error"}),!1;e.loading=!0;var t={cache_page_url:a},l="/waf/waf_get_cache_page_url";Object(j["a"])("post",l,t,(function(a){e.loading=!1,e.pageTamperProofForm.cache_page_content=a.data.cache_page_content,e.pageTamperProofForm.cache_content_type=a.data.cache_content_type}),(function(){e.loading=!1}),"no-message")},removeRuleMatchs(e){var a=this.ruleSmallMatchs.indexOf(e);-1!==a&&this.ruleSmallMatchs.splice(a,1)},addRuleMatchs(){this.ruleSmallMatchs.push({rule_match_key:"",showInput:!1})},onChangeRuleMatchs(e,a){if(e&&e.length>0){var t=this.ruleSmallMatchs.indexOf(a);"default"==e[1]?(this.ruleSmallMatchs[t].showInput=!0,this.ruleSmallMatchs[t].rule_match_key=e[0]+":"):this.ruleSmallMatchs[t].rule_match_key=e[0]+":"+e[1]}},onChangeRuleInput(e,a){var t=this.ruleSmallMatchs.indexOf(a);""==e?(this.ruleSmallMatchs[t].showInput=!1,this.ruleSmallMatchs[t].rule_match_key="",this.ruleSmallMatchs[t].rule_match_key_list=[]):this.ruleSmallMatchs[t].rule_match_key=e}}},V=(t("2fc6"),t("d959")),y=t.n(V);const k=y()(v,[["render",O]]);a["default"]=k}}]);
//# sourceMappingURL=chunk-51f177a6.650e7dbe.js.map