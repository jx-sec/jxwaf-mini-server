(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4bf2124c"],{"20c3":function(e,t,l){"use strict";l.r(t);var r=l("7a23"),a={class:"custom-edit-wrap"},o=Object(r["createVNode"])("h3",null,"Web自定义规则配置",-1),c=Object(r["createVNode"])("div",{class:"margin-4x"},null,-1),u={class:"match-box-content"},n={class:"match_key_cascader"},i={class:"match_key_input"},d=Object(r["createTextVNode"])("删除"),b=Object(r["createTextVNode"])("新增"),s=Object(r["createTextVNode"])("小写处理"),p=Object(r["createTextVNode"])("BASE64解码"),h=Object(r["createTextVNode"])("长度计算"),m=Object(r["createTextVNode"])("URL解码"),f=Object(r["createTextVNode"])("UNICODE解码"),O=Object(r["createTextVNode"])("十六进制解码"),j=Object(r["createTextVNode"])("不处理"),_=Object(r["createVNode"])("div",{class:"margin-4x"},null,-1),w=Object(r["createTextVNode"])("保存 ");function v(e,t){var l=Object(r["resolveComponent"])("el-col"),v=Object(r["resolveComponent"])("el-row"),V=Object(r["resolveComponent"])("el-input"),g=Object(r["resolveComponent"])("el-form-item"),x=Object(r["resolveComponent"])("el-option"),k=Object(r["resolveComponent"])("el-select"),C=Object(r["resolveComponent"])("el-cascader"),y=Object(r["resolveComponent"])("el-button"),N=Object(r["resolveComponent"])("el-checkbox"),P=Object(r["resolveComponent"])("el-checkbox-group"),R=Object(r["resolveComponent"])("el-slider"),F=Object(r["resolveComponent"])("el-switch"),M=Object(r["resolveComponent"])("el-card"),B=Object(r["resolveComponent"])("el-form"),T=Object(r["resolveDirective"])("loading");return Object(r["openBlock"])(),Object(r["createBlock"])("div",a,[Object(r["createVNode"])(v,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(l,{span:24},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(v,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(l,{span:12},{default:Object(r["withCtx"])((function(){return[o]})),_:1}),Object(r["createVNode"])(l,{span:12,class:"text-align-right"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])("a",{class:"el-button el-button--primary",href:"/#/web-rule-protection/"+e.domain+"/"+e.ruleType},"返回",8,["href"])]})),_:1})]})),_:1})]})),_:1})]})),_:1}),c,Object(r["withDirectives"])(Object(r["createVNode"])(v,null,{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(l,{span:24},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(B,{class:"custom-edit-form",model:e.webRuleProForm,rules:e.rules,ref:"webRuleProForm","label-width":"180px"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(M,{class:"box-card"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])("div",null,[Object(r["createVNode"])(g,{label:"规则名称",prop:"rule_name"},{default:Object(r["withCtx"])((function(){return["new"==e.type?(Object(r["openBlock"])(),Object(r["createBlock"])(V,{key:0,modelValue:e.webRuleProForm.rule_name,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.webRuleProForm.rule_name=t}),placeholder:"请输入字母开头，字母或数字组合，仅支持_-两种符号"},null,8,["modelValue"])):Object(r["createCommentVNode"])("",!0),"edit"==e.type?(Object(r["openBlock"])(),Object(r["createBlock"])(V,{key:1,modelValue:e.webRuleProForm.rule_name,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.webRuleProForm.rule_name=t}),disabled:""},null,8,["modelValue"])):Object(r["createCommentVNode"])("",!0)]})),_:1}),Object(r["createVNode"])(g,{label:"规则详情"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(V,{modelValue:e.webRuleProForm.rule_detail,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.webRuleProForm.rule_detail=t})},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"规则依赖"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(k,{modelValue:e.depend,"onUpdate:modelValue":t[4]||(t[4]=function(t){return e.depend=t}),placeholder:"请选择",multiple:""},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.dependList,(function(e){return Object(r["openBlock"])(),Object(r["createBlock"])(x,{key:e.rule_uuid,label:e.rule_name,value:e.rule_uuid},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"匹配参数"},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.ruleMatchs,(function(t,l){return Object(r["openBlock"])(),Object(r["createBlock"])("div",{class:"match-box",key:l},[Object(r["createVNode"])("div",u,[Object(r["createVNode"])("div",n,[Object(r["createVNode"])(C,{separator:":",modelValue:t.rule_match_key_list,"onUpdate:modelValue":function(e){return t.rule_match_key_list=e},options:e.optionsMatchKey,props:e.propsMatchKey,onChange:function(l){return e.onChangeRuleMatchs(l,t)},clearable:""},null,8,["modelValue","onUpdate:modelValue","options","props","onChange"])]),Object(r["withDirectives"])(Object(r["createVNode"])("div",i,[Object(r["createVNode"])(V,{modelValue:t.rule_match_key,"onUpdate:modelValue":function(e){return t.rule_match_key=e},clearable:"",onChange:function(l){return e.onChangeRuleInput(l,t)}},null,8,["modelValue","onUpdate:modelValue","onChange"])],512),[[r["vShow"],t.showInput]])]),Object(r["createVNode"])(y,{onClick:Object(r["withModifiers"])((function(l){return e.removeRuleMatchs(t)}),["prevent"])},{default:Object(r["withCtx"])((function(){return[d]})),_:2},1032,["onClick"])])})),128)),Object(r["createVNode"])(y,{onClick:e.addRuleMatchs,plain:"",type:"primary"},{default:Object(r["withCtx"])((function(){return[b]})),_:1},8,["onClick"])]})),_:1}),Object(r["createVNode"])(g,{label:"匹配方式",prop:"match_operator"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(k,{modelValue:e.webRuleProForm.match_operator,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.webRuleProForm.match_operator=t}),placeholder:"请选择"},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.optionsOperator,(function(e){return Object(r["openBlock"])(),Object(r["createBlock"])(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"匹配内容",prop:"match_value"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(V,{modelValue:e.webRuleProForm.match_value,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.webRuleProForm.match_value=t})},null,8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"参数预处理"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(P,{modelValue:e.checkboxPreprocess,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.checkboxPreprocess=t}),prop:"checkboxPreprocess"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(N,{label:"lowerCase"},{default:Object(r["withCtx"])((function(){return[s]})),_:1}),Object(r["createVNode"])(N,{label:"base64Decode"},{default:Object(r["withCtx"])((function(){return[p]})),_:1}),Object(r["createVNode"])(N,{label:"length"},{default:Object(r["withCtx"])((function(){return[h]})),_:1}),Object(r["createVNode"])(N,{label:"uriDecode"},{default:Object(r["withCtx"])((function(){return[m]})),_:1}),Object(r["createVNode"])(N,{label:"uniDecode"},{default:Object(r["withCtx"])((function(){return[f]})),_:1}),Object(r["createVNode"])(N,{label:"hexDecode"},{default:Object(r["withCtx"])((function(){return[O]})),_:1}),Object(r["createVNode"])(N,{label:"none"},{default:Object(r["withCtx"])((function(){return[j]})),_:1})]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"执行动作",prop:"rule_action"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(k,{modelValue:e.webRuleProForm.rule_action,"onUpdate:modelValue":t[8]||(t[8]=function(t){return e.webRuleProForm.rule_action=t}),placeholder:"请选择"},{default:Object(r["withCtx"])((function(){return[(Object(r["openBlock"])(!0),Object(r["createBlock"])(r["Fragment"],null,Object(r["renderList"])(e.ruleAction,(function(e){return Object(r["openBlock"])(),Object(r["createBlock"])(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(r["createVNode"])(g,{label:"规则优先级",class:"rule-level-box"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(R,{class:"match-inline-block",modelValue:e.ruleLevel,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.ruleLevel=t}),step:1,min:5,max:9,"format-tooltip":e.formatTooltipLevel,"show-stops":""},null,8,["modelValue","format-tooltip"])]})),_:1}),Object(r["createVNode"])(g,{label:"规则状态"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(F,{modelValue:e.webRuleProForm.status,"onUpdate:modelValue":t[10]||(t[10]=function(t){return e.webRuleProForm.status=t}),"active-value":"true","inactive-value":"false"},null,8,["modelValue"])]})),_:1})])]})),_:1})]})),_:1},8,["model","rules"]),_,Object(r["createVNode"])(v,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(l,{span:24},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(v,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(l,{span:12},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])("a",{class:"el-button el-button--default",href:"/#/web-rule-protection/"+e.domain+"/"+e.ruleType},"返回",8,["href"])]})),_:1}),Object(r["createVNode"])(l,{span:12,class:"text-align-right"},{default:Object(r["withCtx"])((function(){return[Object(r["createVNode"])(y,{type:"primary",onClick:t[11]||(t[11]=function(t){return e.onClickWebRuleProSubmit("webRuleProForm")}),loading:e.loading},{default:Object(r["withCtx"])((function(){return[w]})),_:1},8,["loading"])]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1},512),[[T,e.loadingPage,void 0,{fullscreen:!0,lock:!0}]])])}l("ac1f"),l("1276"),l("fb6a"),l("159b"),l("a9e3"),l("5319"),l("a15b"),l("d3b7"),l("25f0"),l("a434");var V=l("362c"),g=l("6c02"),x={mixins:[V["b"]],data:function(){return{loading:!1,loadingPage:!0,domain:"",ruleType:"",uuid:"new",webRuleProForm:{rule_detail:"",rule_depend_uuid:"",match_preprocess:"",match_key:[]},type:"edit",depend:[],dependList:[],optionsMatchKey:[{value:"http",label:"http",children:[{value:"path",label:"path"},{value:"query_string",label:"query_string"},{value:"method",label:"method"},{value:"src_ip",label:"src_ip"},{value:"body",label:"body"},{value:"version",label:"version"},{value:"scheme",label:"scheme"}]},{value:"header",label:"header",children:[{value:"cookie",label:"cookie"},{value:"referer",label:"referer"},{value:"user_agent",label:"user_agent"},{value:"default",label:"自定义"}]},{value:"cookie",label:"cookie",children:[{value:"default",label:"自定义"}]}],propsMatchKey:{expandTrigger:"hover"},ruleMatchs:[{rule_match_key_list:[],rule_match_key:"",showInput:!1}],operator:"",optionsOperator:[{value:"rx",label:"正则匹配"},{value:"str_prefix",label:"前缀匹配"},{value:"str_suffix",label:"后缀匹配"},{value:"str_contain",label:"包含"},{value:"str_ncontain",label:"不包含"},{value:"str_eq",label:"等于"},{value:"str_neq",label:"不等于"},{value:"gt",label:"数字大于"},{value:"lt",label:"数字小于"},{value:"eq",label:"数字等于"},{value:"neq",label:"数字不等于"}],ruleAction:[{value:"deny",label:"阻断"},{value:"redirect",label:"重定向到首页"},{value:"log",label:"观察模式"},{value:"pre_rule",label:"前置规则"},{value:"pre_rule_no_log",label:"前置规则(不记录日志)"}],ruleLevel:5,checkboxPreprocess:[]}},computed:{rules:function(){return{rule_name:[{required:!0,message:"请输入规则名称",trigger:["blur","change"]},{validator:V["e"],trigger:["blur","change"]}],match_operator:[{required:!0,message:"请选择匹配方式",trigger:"change"}],match_value:[{required:!0,message:"请输入匹配内容",trigger:["blur","change"]}],rule_action:[{required:!0,message:"请选择执行动作",trigger:"change"}],checkboxPreprocess:[{type:"array",required:!0,message:"请至少选择一个",trigger:"change"}]}}},mounted:function(){var e=this,t=Object(g["c"])();this.ruleType=t.params.ruleType,this.domain=t.params.domain,this.uuid=t.params.uuid,Object(V["a"])("post","/waf/waf_get_web_rule_depend_list",{domain:e.domain,rule_type:e.ruleType},(function(t){var l=t.data.message;for(var r in l)l[r].rule_uuid!=e.uuid&&e.dependList.push(l[r]);"new"==e.uuid?(e.type="new",e.loadingPage=!1):(e.type="edit",e.loadingPage=!0,e.getData())}),(function(){e.dependList=[]}),"no-message")},methods:{getData:function(){var e=this;Object(V["a"])("post","/waf/waf_get_web_rule_protection",{domain:e.domain,rule_type:e.ruleType,rule_uuid:e.uuid},(function(t){e.loadingPage=!1,e.webRuleProForm=t.data.message,e.checkboxPreprocess=e.webRuleProForm.match_preprocess.split(",");var l=e.webRuleProForm.match_key.substr(1).slice(0,-1).split(",");e.ruleMatchs=[],l.forEach((function(t){e.ruleMatchs.push({rule_match_key:t,rule_match_key_list:t.split(":"),showInput:!0})})),e.ruleLevel=Number(e.webRuleProForm.rule_level);var r=e.webRuleProForm.rule_depend_uuid.replace(/\s*/g,"").replace(/u/g,"").replace(/'/g,"").replace("[","").replace("]","");e.depend=r.split(",")}),(function(){e.loadingPage=!1}),"no-message")},onClickWebRuleProSubmit:function(e){var t=this,l="/waf/waf_edit_web_rule_protection";"new"==t.type?l="/waf/waf_create_web_rule_protection":t.webRuleProForm.rule_uuid=t.uuid,t.webRuleProForm.domain=t.domain,t.webRuleProForm.rule_type=t.ruleType,t.webRuleProForm.match_preprocess=t.checkboxPreprocess.join(","),t.webRuleProForm.rule_level=t.ruleLevel.toString(),t.webRuleProForm.rule_depend_uuid=t.depend;var r="{";for(var a in t.ruleMatchs)r+=t.ruleMatchs[a].rule_match_key+",";t.webRuleProForm.match_key=r.slice(0,-1)+"}",this.$refs[e].validate((function(e){e&&(t.loading=!0,Object(V["a"])("post",l,t.webRuleProForm,(function(e){t.loading=!1,"new"==t.type?window.location.href="/#/web-rule-protection/"+t.domain+"/"+t.ruleType:t.getData()}),(function(){t.loading=!1})))}))},removeRuleMatchs:function(e){var t=this.ruleMatchs.indexOf(e);-1!==t&&this.ruleMatchs.splice(t,1)},addRuleMatchs:function(){this.ruleMatchs.push({rule_match_key:"",showInput:!1})},onChangeRuleMatchs:function(e,t){var l=this.ruleMatchs.indexOf(t);"default"==e[1]?(this.ruleMatchs[l].showInput=!0,this.ruleMatchs[l].rule_match_key=e[0]+":"):this.ruleMatchs[l].rule_match_key=e[0]+":"+e[1]},onChangeRuleInput:function(e,t){var l=this.ruleMatchs.indexOf(t);""==e?(this.ruleMatchs[l].showInput=!1,this.ruleMatchs[l].rule_match_key="",this.ruleMatchs[l].rule_match_key_list=[]):this.ruleMatchs[l].rule_match_key=e},formatTooltipLevel:function(e){var t={9:"最高",8:"高",7:"中",6:"低",5:"最低"};return t[e]}}};l("dd6f");x.render=v;t["default"]=x},"4e42":function(e,t,l){},dd6f:function(e,t,l){"use strict";l("4e42")}}]);
//# sourceMappingURL=chunk-4bf2124c.js.map