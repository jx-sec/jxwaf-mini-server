(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d72782b2"],{"1dde":function(e,t,a){var l=a("d039"),r=a("b622"),c=a("2d00"),u=r("species");e.exports=function(e){return c>=51||!l((function(){var t=[],a=t.constructor={};return a[u]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},"74ff":function(e,t,a){"use strict";a.r(t);var l=a("7a23"),r={class:"custom-edit-wrap"},c=Object(l["createVNode"])("h3",null,"流量防护规则",-1),u=Object(l["createVNode"])("div",{class:"margin-4x"},null,-1),o={class:"match-box-content"},n={class:"match_key_cascader"},s={class:"match_key_input"},i=Object(l["createTextVNode"])("删除"),d=Object(l["createTextVNode"])("新增"),b={class:"match-box-content"},h={class:"match_key_cascader"},p=Object(l["createTextVNode"])("删除"),f=Object(l["createTextVNode"])("新增"),g={class:"card-item-bottom"},_=Object(l["createTextVNode"])("删除"),m={class:"card-footer"},v=Object(l["createTextVNode"])("新增"),O=Object(l["createVNode"])("div",{class:"margin-4x"},null,-1),j=Object(l["createTextVNode"])("保存 ");function w(e,t){var a=Object(l["resolveComponent"])("el-col"),w=Object(l["resolveComponent"])("el-row"),y=Object(l["resolveComponent"])("el-input"),k=Object(l["resolveComponent"])("el-form-item"),V=Object(l["resolveComponent"])("el-cascader"),M=Object(l["resolveComponent"])("el-button"),x=Object(l["resolveComponent"])("el-option"),B=Object(l["resolveComponent"])("el-select"),C=Object(l["resolveComponent"])("el-card"),N=Object(l["resolveComponent"])("el-switch"),R=Object(l["resolveComponent"])("el-form"),F=Object(l["resolveDirective"])("loading");return Object(l["openBlock"])(),Object(l["createBlock"])("div",r,[Object(l["createVNode"])(w,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(a,{span:24},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(w,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(a,{span:12},{default:Object(l["withCtx"])((function(){return[c]})),_:1}),Object(l["createVNode"])(a,{span:12,class:"text-align-right"},{default:Object(l["withCtx"])((function(){return["group_rule"==e.ruleType?(Object(l["openBlock"])(),Object(l["createBlock"])("a",{key:0,class:"el-button el-button--primary is-plain",href:"/#/group-rule/"+e.uuid+"/sys-flow-rule-protection"},"返回",8,["href"])):(Object(l["openBlock"])(),Object(l["createBlock"])("a",{key:1,class:"el-button el-button--primary is-plain",href:"/#/sys-flow-rule-protection/"+e.ruleType},"返回",8,["href"]))]})),_:1})]})),_:1})]})),_:1})]})),_:1}),u,Object(l["withDirectives"])(Object(l["createVNode"])(w,null,{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(a,{span:24},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(R,{class:"custom-edit-form",model:e.webRuleManageForm,rules:e.rules,ref:"webRuleManageForm","label-width":"180px"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(C,{class:"box-card"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])("div",null,[Object(l["createVNode"])(k,{label:"规则名称",prop:"rule_name"},{default:Object(l["withCtx"])((function(){return["new"==e.type?(Object(l["openBlock"])(),Object(l["createBlock"])(y,{key:0,modelValue:e.webRuleManageForm.rule_name,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.webRuleManageForm.rule_name=t}),placeholder:"请输入字母开头，字母或数字组合，仅支持_-两种符号"},null,8,["modelValue"])):(Object(l["openBlock"])(),Object(l["createBlock"])(y,{key:1,modelValue:e.webRuleManageForm.rule_name,"onUpdate:modelValue":t[2]||(t[2]=function(t){return e.webRuleManageForm.rule_name=t}),disabled:""},null,8,["modelValue"]))]})),_:1}),Object(l["createVNode"])(k,{label:"规则详情"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(y,{modelValue:e.webRuleManageForm.rule_detail,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.webRuleManageForm.rule_detail=t})},null,8,["modelValue"])]})),_:1}),Object(l["createVNode"])(C,{class:"box-card-rule",shadow:"never"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(e.ruleBigMatchs,(function(t,a){return Object(l["openBlock"])(),Object(l["createBlock"])("div",{class:"card-item",key:a},[Object(l["createVNode"])(k,{label:"匹配参数"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(t.ruleSmallMatchs,(function(t,r){return Object(l["openBlock"])(),Object(l["createBlock"])("div",{class:"match-box",key:r},[Object(l["createVNode"])("div",o,[Object(l["createVNode"])("div",n,[Object(l["createVNode"])(V,{separator:":",modelValue:t.rule_match_key_list,"onUpdate:modelValue":function(e){return t.rule_match_key_list=e},options:e.optionsMatchKey,props:e.propsMatchKey,onChange:function(l){return e.onChangeRuleMatchs(l,t,a)},clearable:""},null,8,["modelValue","onUpdate:modelValue","options","props","onChange"])]),Object(l["withDirectives"])(Object(l["createVNode"])("div",s,[Object(l["createVNode"])(y,{modelValue:t.rule_match_key,"onUpdate:modelValue":function(e){return t.rule_match_key=e},clearable:"",onChange:function(l){return e.onChangeRuleInput(l,t,a)}},null,8,["modelValue","onUpdate:modelValue","onChange"])],512),[[l["vShow"],t.showInput]])]),Object(l["createVNode"])(M,{onClick:Object(l["withModifiers"])((function(l){return e.removeRuleMatchs(t,a)}),["prevent"])},{default:Object(l["withCtx"])((function(){return[i]})),_:2},1032,["onClick"])])})),128)),Object(l["createVNode"])(M,{onClick:function(t){return e.addRuleMatchs(a)},plain:"",type:"primary"},{default:Object(l["withCtx"])((function(){return[d]})),_:2},1032,["onClick"])]})),_:2},1024),Object(l["createVNode"])(k,{label:"参数处理"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(t.argsPrepocessList,(function(t,r){return Object(l["openBlock"])(),Object(l["createBlock"])("div",{class:"match-box",key:r},[Object(l["createVNode"])("div",b,[Object(l["createVNode"])("div",h,[Object(l["createVNode"])(B,{modelValue:t.args_prepocess_value,"onUpdate:modelValue":function(e){return t.args_prepocess_value=e},placeholder:"Select"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(e.optionsArgs,(function(e){return Object(l["openBlock"])(),Object(l["createBlock"])(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])])]),Object(l["createVNode"])(M,{onClick:Object(l["withModifiers"])((function(l){return e.removeArgsPrepocess(t,a)}),["prevent"])},{default:Object(l["withCtx"])((function(){return[p]})),_:2},1032,["onClick"])])})),128)),Object(l["createVNode"])(M,{onClick:function(t){return e.addArgsPrepocess(a)},plain:"",type:"primary"},{default:Object(l["withCtx"])((function(){return[f]})),_:2},1032,["onClick"])]})),_:2},1024),Object(l["createVNode"])(k,{label:"匹配方式"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(B,{modelValue:t.match_operator,"onUpdate:modelValue":function(e){return t.match_operator=e},placeholder:"请选择"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(e.optionsOperator,(function(e){return Object(l["openBlock"])(),Object(l["createBlock"])(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:2},1032,["modelValue","onUpdate:modelValue"])]})),_:2},1024),Object(l["createVNode"])(k,{label:"匹配内容"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(y,{modelValue:t.match_value,"onUpdate:modelValue":function(e){return t.match_value=e}},null,8,["modelValue","onUpdate:modelValue"])]})),_:2},1024),Object(l["createVNode"])("div",g,[Object(l["createVNode"])(M,{type:"danger",plain:"",onClick:Object(l["withModifiers"])((function(a){return e.removeRuleBigMatchs(t)}),["prevent"])},{default:Object(l["withCtx"])((function(){return[_]})),_:2},1032,["onClick"])])])})),128)),Object(l["createVNode"])("div",m,[Object(l["createVNode"])(M,{class:"button",type:"primary",onClick:t[4]||(t[4]=function(t){return e.addRuleBigMatchs(e.bigIndex)})},{default:Object(l["withCtx"])((function(){return[v]})),_:1})])]})),_:1}),Object(l["createVNode"])(k,{label:"执行动作",prop:"rule_action"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(B,{modelValue:e.webRuleManageForm.rule_action,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.webRuleManageForm.rule_action=t}),placeholder:"请选择"},{default:Object(l["withCtx"])((function(){return[(Object(l["openBlock"])(!0),Object(l["createBlock"])(l["Fragment"],null,Object(l["renderList"])(e.ruleAction,(function(e){return Object(l["openBlock"])(),Object(l["createBlock"])(x,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),Object(l["createVNode"])(k,{label:"执行内容",prop:"action_value"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(y,{modelValue:e.webRuleManageForm.action_value,"onUpdate:modelValue":t[6]||(t[6]=function(t){return e.webRuleManageForm.action_value=t})},null,8,["modelValue"])]})),_:1}),Object(l["createVNode"])(k,{label:"日志记录"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(N,{modelValue:e.webRuleManageForm.rule_log,"onUpdate:modelValue":t[7]||(t[7]=function(t){return e.webRuleManageForm.rule_log=t}),"active-value":"true","inactive-value":"false"},null,8,["modelValue"])]})),_:1})])]})),_:1})]})),_:1},8,["model","rules"]),O,Object(l["createVNode"])(w,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(a,{span:24},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(w,{type:"flex",class:"row-bg",justify:"space-between"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(a,{span:12},{default:Object(l["withCtx"])((function(){return["group_rule"==e.ruleType?(Object(l["openBlock"])(),Object(l["createBlock"])("a",{key:0,class:"el-button el-button--primary is-plain",href:"/#/group-rule/"+e.uuid+"/sys-flow-rule-protection"},"返回",8,["href"])):(Object(l["openBlock"])(),Object(l["createBlock"])("a",{key:1,class:"el-button el-button--primary is-plain",href:"/#/sys-flow-rule-protection/"+e.ruleType},"返回",8,["href"]))]})),_:1}),Object(l["createVNode"])(a,{span:12,class:"text-align-right"},{default:Object(l["withCtx"])((function(){return[Object(l["createVNode"])(M,{type:"primary",onClick:t[8]||(t[8]=function(t){return e.onClickWebRuleProSubmit("webRuleManageForm")}),loading:e.loading},{default:Object(l["withCtx"])((function(){return[j]})),_:1},8,["loading"])]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1})]})),_:1},512),[[F,e.loadingPage,void 0,{fullscreen:!0,lock:!0}]])])}a("b64b"),a("ac1f"),a("1276"),a("a434");var y=a("362c"),k=a("6c02"),V={mixins:[y["b"]],data:function(){return{loading:!1,loadingPage:!1,uuid:"",ruleType:"single_rule",webRuleManageForm:{rule_detail:"",action_value:""},type:"edit",optionsMatchKey:[{value:"http_args",label:"http_args",children:[{value:"path",label:"path"},{value:"query_string",label:"query_string"},{value:"method",label:"method"},{value:"src_ip",label:"src_ip"},{value:"raw_body",label:"raw_body"},{value:"version",label:"version"},{value:"scheme",label:"scheme"},{value:"raw_header",label:"raw_header"}]},{value:"header_args",label:"header_args",children:[{value:"host",label:"host"},{value:"cookie",label:"cookie"},{value:"referer",label:"referer"},{value:"user_agent",label:"user_agent"},{value:"default",label:"自定义"}]},{value:"cookie_args",label:"cookie_args",children:[{value:"default",label:"自定义"}]},{value:"uri_args",label:"uri_args",children:[{value:"default",label:"自定义"}]},{value:"post_args",label:"post_args",children:[{value:"default",label:"自定义"}]},{value:"json_post_args",label:"json_post_args",children:[{value:"default",label:"自定义"}]},{value:"ctx_args",label:"ctx_args",children:[{value:"default",label:"自定义"}]},{value:"shared_dict",label:"shared_dict",children:[{value:"default",label:"自定义"}]},{value:"string",label:"string",children:[{value:"default",label:"自定义"}]}],propsMatchKey:{expandTrigger:"hover"},ruleBigMatchs:[{ruleSmallMatchs:[{rule_match_key_list:[],rule_match_key:"",showInput:!1}],match_operator:"",match_value:"",checkboxPreprocess:[],argsPrepocessList:[{args_prepocess_value:""}]}],operator:"",optionsOperator:[{value:"rx",label:"正则匹配"},{value:"str_prefix",label:"前缀匹配"},{value:"str_suffix",label:"后缀匹配"},{value:"str_contain",label:"包含"},{value:"str_ncontain",label:"不包含"},{value:"str_eq",label:"等于"},{value:"str_neq",label:"不等于"},{value:"gt",label:"数字大于"},{value:"lt",label:"数字小于"},{value:"eq",label:"数字等于"},{value:"neq",label:"数字不等于"}],optionsArgs:[{value:"lowerCase",label:"小写处理",key:"lowerCase"},{value:"base64Decode",label:"BASE64解码",key:"base64Decode"},{value:"length",label:"长度计算",key:"length"},{value:"uriDecode",label:"URL解码",key:"uriDecode"},{value:"uniDecode",label:"UNICODE解码",key:"uniDecode"},{value:"hexDecode",label:"十六进制解码",key:"hexDecode"},{value:"none",label:"不处理",key:"none"}],ruleAction:[{value:"deny",label:"拦截"},{value:"redirect",label:"重定向到首页"},{value:"watch",label:"观察模式"},{value:"dict_write",label:"缓存写入"},{value:"dict_del",label:"缓存删除"},{value:"dict_add",label:"缓存增加"},{value:"dict_reduce",label:"缓存减少"}]}},computed:{rules:function(){return{rule_name:[{required:!0,message:"请输入规则名称",trigger:["blur","change"]},{validator:y["g"],trigger:["blur","change"]}],action_value:[{required:!0,message:"请选择匹配方式",trigger:"change"}],match_value:[{required:!0,message:"请输入匹配内容",trigger:["blur","change"]}],rule_action:[{required:!0,message:"请选择执行动作",trigger:"change"}],checkboxPreprocess:[{type:"array",required:!0,message:"请至少选择一个",trigger:"change"}]}}},mounted:function(){var e=this,t=Object(k["c"])();e.uuid=t.params.uuid,e.ruleType=t.params.ruleType,e.type=t.params.type,"new"==e.type?e.loadingPage=!1:(e.loadingPage=!0,e.getData())},methods:{getData:function(){var e=this,t="/waf/waf_get_sys_flow_rule_protection",a={rule_uuid:e.uuid,rule_type:e.ruleType};"group_rule"==e.ruleType&&(a={rule_uuid:e.type,rule_type:e.ruleType}),Object(y["a"])("post",t,a,(function(t){e.loadingPage=!1,e.webRuleManageForm=t.data.message;var a=JSON.parse(e.webRuleManageForm.rule_matchs),l=[];for(var r in a){var c=[],u=[],o=["cookie"];for(var n in a[r].match_args){var s=a[r].match_args[n],i=Object.keys(s)[0],d="false";o.indexOf(i)>-1&&(d="true"),c.push({rule_match_key_list:[i,s[i]],rule_match_key:i+":"+s[i],showInput:d})}for(var b in a[r].args_prepocess)u.push({args_prepocess_value:a[r].args_prepocess[b]});l.push({ruleSmallMatchs:c,argsPrepocessList:u,match_operator:a[r].match_operator,match_value:a[r].match_value})}e.ruleBigMatchs=l}),(function(){e.loadingPage=!1}),"no-message")},onClickWebRuleProSubmit:function(e){var t=this,a=[];for(var l in t.ruleBigMatchs){var r=[],c=[];for(var u in t.ruleBigMatchs[l].ruleSmallMatchs){var o=t.ruleBigMatchs[l].ruleSmallMatchs[u];if(""==o.rule_match_key)return t.$message({showClose:!0,message:"请选择匹配参数",type:"error"}),!1;var n="",s=o.rule_match_key&&o.rule_match_key.split(":");s.length>=2&&(n='{"'+s[0]+'" : "'+s[1]+'"}'),r.push(JSON.parse(n))}for(var i in t.ruleBigMatchs[l].argsPrepocessList){if(""==t.ruleBigMatchs[l].argsPrepocessList[i].args_prepocess_value)return t.$message({showClose:!0,message:"请选择参数处理",type:"error"}),!1;c.push(t.ruleBigMatchs[l].argsPrepocessList[i].args_prepocess_value)}if(""==t.ruleBigMatchs[l].match_operator)return t.$message({showClose:!0,message:"请选择匹配方式",type:"error"}),!1;if(""==t.ruleBigMatchs[l].match_value)return t.$message({showClose:!0,message:"请输入匹配内容",type:"error"}),!1;a.push({match_args:r,args_prepocess:c,match_operator:t.ruleBigMatchs[l].match_operator,match_value:t.ruleBigMatchs[l].match_value})}var d="/waf/waf_edit_sys_flow_rule_protection";"new"==t.type?(d="/waf/waf_create_sys_flow_rule_protection","group_rule"==t.ruleType&&(t.webRuleManageForm.rule_group_uuid=t.uuid)):(t.webRuleManageForm.rule_uuid=t.uuid,"group_rule"==t.ruleType&&(t.webRuleManageForm.rule_uuid=t.type)),t.webRuleManageForm.rule_type=t.ruleType,t.webRuleManageForm.rule_matchs=JSON.stringify(a),this.$refs[e].validate((function(e){e&&(t.loading=!0,Object(y["a"])("post",d,t.webRuleManageForm,(function(e){t.loading=!1,"group_rule"==t.ruleType?window.location.href="/#/group-rule/"+t.uuid+"/sys-flow-rule-protection":window.location.href="/#/sys-flow-rule-protection/"+t.ruleType}),(function(){t.loading=!1})))}))},removeRuleMatchs:function(e,t){var a=this.ruleBigMatchs[t].ruleSmallMatchs.indexOf(e);-1!=a&&0!=a&&this.ruleBigMatchs[t].ruleSmallMatchs.splice(a,1)},removeRuleBigMatchs:function(e){var t=this.ruleBigMatchs.indexOf(e);-1!=t&&0!=t&&this.ruleBigMatchs.splice(t,1)},addRuleMatchs:function(e){this.ruleBigMatchs[e].ruleSmallMatchs.push({rule_match_key:"",showInput:!1})},addRuleBigMatchs:function(e){this.ruleBigMatchs.push({ruleSmallMatchs:[{rule_match_key_list:[],rule_match_key:"",showInput:!1}],match_operator:"",match_value:"",checkboxPreprocess:[],argsPrepocessList:[{args_prepocess_value:""}]})},removeArgsPrepocess:function(e){var t=this.ruleBigMatchs.indexOf(e);-1!==t&&this.ruleBigMatchs.splice(t,1)},addArgsPrepocess:function(e){this.ruleBigMatchs[e].argsPrepocessList.push({args_prepocess_value:""})},onChangeRuleMatchs:function(e,t,a){var l=this.ruleBigMatchs[a].ruleSmallMatchs.indexOf(t);"default"==e[1]?(this.ruleBigMatchs[a].ruleSmallMatchs[l].showInput=!0,this.ruleBigMatchs[a].ruleSmallMatchs[l].rule_match_key=e[0]+":"):this.ruleBigMatchs[a].ruleSmallMatchs[l].rule_match_key=e[0]+":"+e[1]},onChangeRuleInput:function(e,t,a){var l=this.ruleBigMatchs[a].ruleSmallMatchs.indexOf(t);""==e?(this.ruleBigMatchs[a].ruleSmallMatchs[l].showInput=!1,this.ruleBigMatchs[a].ruleSmallMatchs[l].rule_match_key="",this.ruleBigMatchs[a].ruleSmallMatchs[l].rule_match_key_list=[]):this.ruleBigMatchs[a].ruleSmallMatchs[l].rule_match_key=e}}};a("a6ba");V.render=w;t["default"]=V},8418:function(e,t,a){"use strict";var l=a("a04b"),r=a("9bf2"),c=a("5c6c");e.exports=function(e,t,a){var u=l(t);u in e?r.f(e,u,c(0,a)):e[u]=a}},"8eba":function(e,t,a){},a434:function(e,t,a){"use strict";var l=a("23e7"),r=a("23cb"),c=a("a691"),u=a("50c4"),o=a("7b0b"),n=a("65f0"),s=a("8418"),i=a("1dde"),d=i("splice"),b=Math.max,h=Math.min,p=9007199254740991,f="Maximum allowed length exceeded";l({target:"Array",proto:!0,forced:!d},{splice:function(e,t){var a,l,i,d,g,_,m=o(this),v=u(m.length),O=r(e,v),j=arguments.length;if(0===j?a=l=0:1===j?(a=0,l=v-O):(a=j-2,l=h(b(c(t),0),v-O)),v+a-l>p)throw TypeError(f);for(i=n(m,l),d=0;d<l;d++)g=O+d,g in m&&s(i,d,m[g]);if(i.length=l,a<l){for(d=O;d<v-l;d++)g=d+l,_=d+a,g in m?m[_]=m[g]:delete m[_];for(d=v;d>v-l+a;d--)delete m[d-1]}else if(a>l)for(d=v-l;d>O;d--)g=d+l-1,_=d+a-1,g in m?m[_]=m[g]:delete m[_];for(d=0;d<a;d++)m[d+O]=arguments[d+2];return m.length=v-l+a,i}})},a6ba:function(e,t,a){"use strict";a("8eba")},b64b:function(e,t,a){var l=a("23e7"),r=a("7b0b"),c=a("df75"),u=a("d039"),o=u((function(){c(1)}));l({target:"Object",stat:!0,forced:o},{keys:function(e){return c(r(e))}})}}]);
//# sourceMappingURL=chunk-d72782b2.js.map